# 3. ネットワーク
## 通信プロトコルの標準化
### OSI参照モデル

|階層|名称|役割|
|---|---|---|
|7|アプリケーション層|やり取りされたデータの意味内容を直接取り扱う. SMTP, HTTPなどそれぞれのアプリケーションに特化したプロトコル|
|6|プレゼンテーション層|データの表現形式を管理する. 文字コードや圧縮の種類などのデータの特性を規定する|
|5|セッション層|最終的な通信の目的に合わせてデータの送受信管理を行う. コネクション確立、データ転送のタイミング管理を行、特性の異なる通信の差異を吸収する|
|4|トランスポート層|エラーの検出/再送などデータ転送の制御により通信の品質を保証する. `ポート番号`によりノードないのアプリケーションを特定する. `TCP`や`UDP`がこの層に該当する|
|3|ネットワーク層|エンドツーエンドのやり取りを規定. MACアドレスをはじめとするデータリンクアドレスはローカルネットワーク内だけで有効であるため、ネットワークを超えた通信を行う場合に付け替える必要があるが、ネットワーク層で提供されるアドレスは、通信の最初から最後まで一貫したアドレスである. `IP`がこの層に該当する.|
|2|データリンク層|同じネットワークに接続された隣接ノード間での通信について規定. `HDLC`手順や、MACフレームの規格が該当する|
|1|物理層|システムの物理的、電気的な性質を規定する. |


#### プロトコルとサービス
`プロトコル`とは、各層に属するエンティティどうしが相互に通信を行うための取り決めのこと.  
上位の層が下位の層を利用しながら通信を行うため、異なる階層間のエンティティどうしが通信する窓口が必要になる.  
これを提供するのが下位層であり、`サービス`と呼ばれる.  

### TCP/IPプロトコルスイート
同じ団体が作ったプロトコルのセットのことを`プロトコルスイート`と呼ぶ.  

#### TCP/IPの通信
TCP/IPではデータを`パケット`と呼ばれる単位に区切り、各パケットに`ヘッダ`を付けて送信する.  
各ヘッダには、その階層で必要となる送信元や送信先、大きさ、順番などパケット自体に関する情報が含まれている.  

#### MACアドレス
イーサネットやFDDIで使用される物理アドレス.  
データリンク層で使用され、同じネットワークに接続された隣接ノード間の通信で相手を識別するために使う.  
MACアドレスの長さは6バイトで、先頭24ビットのOUI(ベンダID)と後続24ビットの固有製造番号から構成される.  
MACアドレスは機器が固有に持つ番号なので、必ず一意に定まるようにIEEEが管理している.  

#### IPアドレス
ネットワーク層のプロトコルIPで利用されるノードを特定するためのアドレス.  

#### ポート番号
トランスポート層においてノードないのアプリケーションを識別するための番号.  
指定できる範囲は、TCPやUDPごとに0~65535と決まっている.  
このうち0~1023は`Well-Knownポート`として標準化されている.  

**Well-Knownポートの代表例**  

| プロトコル  |ポート|
|---|---|
|SSH|TCP22|
|Telnet|TCP23|
|SMTP|TCP25|
|DNS|UDP53|
|HTTP|TCP80|
|POP3|TCP110|
|IMAP4|TCP143|
|HTTPS|TCP443|
|NTP|UDP123|
|SNMP|UDP161|
|SNMP Trap|UDP162|


#### ネットワーク間の通信
- 同じネットワークに接続されたノード間はデータリンク層の通信
- ネットワークを超えたノード間はネットワーク層の通信


## ネットワーク接続装置と関連技術
### 物理層の接続
#### リピータ
ネットワーク上を流れる電流の増幅装置、あるいは整流装置.  
データ通信は、ネットワーク上を流れる電流の形で実現され、ケーブルが長いと電流が減衰したり、
波形が乱れてデータが読み取れなくなる.  
これを防ぐため、一定の距離ごとにリピータを設置して、電流の増幅と整流を行う必要がある.  

### データリンク層の接続
#### ブリッジ
データリンク層に位置し、ネットワーク上を流れているフレームのMACアドレスを認識して、
通信を中継する装置.  
接続されている各ノードのMACアドレスを記憶し、接続されているノードを`コリジョンドメイン`に分割することで、
MACアドレスにより判別したフレームの宛先のあるセグメントにのみフレームを送信する.  

#### スイッチングハブ
`レイヤ2スイッチ`と呼ばれる装置.  
MACアドレスを認識してフレームの宛先を決めて通信を行うという、ブリッジと同じ働きをする.

##### ブロードキャストストーム
LANスイッチは、ブロードキャストフレームを受信ポート以外の全てのポートに転送する.  
そのため、これらの機器をループ状に接続し冗長化した場合、信頼性は向上するが、
ブロードキャストフレームは永遠に回り続けながら増殖し、最終的にはネットワークダウンを招く.  

`スパニングツリープロトコル`はこの現象を防ぐためのプロトコル.  
ループを構成している一部のポートを、通常運用時にはブロックすることで、
ネットワーク全体をループを持たない論理ツリー構造にする.  

### ネットワーク層の接続
#### ルータ
宛先IPアドレスを見て、パケットの送り先を決め、通信を制御する装置.  
ルータで分けられたネットワークの単位を`ブロードキャストドメイン`と呼ぶ.  

##### ルーティング
ルーティングテーブルの作成方法には、手作業で作成する`スタティックルーティング`と
ルーティングプロトコルを利用することによってルータどうしが経路に関する情報の交換を行い、
自律的にルーティングテーブルを作成する`ダイナミックルーティング`がある.  

**代表的なルーティングプロトコル**  

|プロトコル|説明|
|--------|----|
|RIP|ディスタンスベクタ型のルーティングプロトコル. 宛先ネットワークまでのルータの数が最小になる経路を選択する|
|OSPF|リンクステート型のルーティングプロトコル. 最も小さいコスト値の経路を選択する|


##### ルータの冗長構成
`VRRP`は、同一のLANに接続された複数のルータを、仮想的に1台のルータとして見えるようにして
冗長構成を実現するプロトコル.  

#### レイヤ3スイッチ
ネットワーク層に位置する通信機器. 専用ハードウェアによって転送処理を行っている.
高速に処理が行えるため、大容量のファイルを扱うファイルサーバへのアクセスなどに適している.  


### トランスポート層以上の接続
#### ゲートウェイ
トランスポート層~アプリケーション層についてネットワーク接続を行う装置.  
ゲートウェイでは、第4層の露タンスポート層以上が異なるLANシステム相互間のプロトコル変換やデータ形式の変換を行う.  

#### L4スイッチ、L7スイッチ
`L4スイッチ`は、定義としてはゲートウェイに属するが、機能的にはレイヤ2スイッチ、レイヤ3スイッチの延長線上にある装置.  
TCPポート番号やUDPポート番号も経路制御判断の情報として扱うことができる.  
`L7スイッチ`じゃ、アプリケーション層までの情報を使って通信制御を行う装置.  

#### SDN
Software-Defined Networking.  
これを実現する技術の一つが、`OpenFlow`というネットワーク機器の制御のためのプロトコル.  
ネットワーク機器の持つ転送機能と経路制御機能を分離して、ソフトウェアによって制御する.  

### VLAN
Virtual LAN.  
物理的な接続形態に依存せず、ノードを任意に論理的なグループに分けるための仕組み.  
機能の特徴は、ブロードキャストドメインの分割. 各VLANは、ルータやL3SWで分割されたネットワークと同じように機能する.  

#### VLAN ID
VLAN機能を持っているL3SWは、ポート番号の先に存在するノードに`VLAN ID`を設定できる.  
IPアドレス体系を変更せずにネットワークの分割・統合を行うことができ、ネットワーク運用に柔軟性を持たせることができる.  

#### ポートVLAN
スイッチのポートごとにVLANを割り当てる方式. 
ポートとVLANの対応が固定される.  
`スタティックVLAN`とも呼ばれる. 
シンプルで使いやすい利点があるが、VLAN構成が物理的な結線に依存するため柔軟性の点で劣る.  

#### タグVLAN
VLAN IDを含むタグ情報をMACフレームに埋め込み、フレーム単位でVLANを区別する方式.  
`IEEE 802.1Q`で標準化されている.  



## データリンク層の制御とプロトコル
### メディアアクセス制御
複数のデータを１つのケーブルを通して送受する場合に必要になる、データ衝突の回避制御のこと.  

#### CSMA/CD
イーサネットで採用されているメディアアクセス制御方式で、衝突検知方式を採用している. 
トラフィックが増加するにつれて衝突が多くなり、再送が増える.  
伝送路の使用率が30%を超えると実用的ではなくなる.  

- 各ノードは伝送媒体が使用中稼働か調べて、使用中でなければデータの送信を開始する.
- 複数のノードは同時に通信を開始するとデータの衝突が起きる.
- 衝突を検知し、一定時間待った後で、再送する.
- 一定の距離以上のケーブルでは衝突が検知できない.

#### トークンパッシング方式
トークンによる送信制御を行う方法. バス型のLANで使用する`トークンバス方式`とリング型LANで使用する`トークンリング方式`がある.  
伝送媒体上での衝突は発生しないが、トラフィックが増加するにつれてトークンを獲得しにくくなり、徐々に遅延時間が増加する. しかし、衝突による再送制御の必要がないため、伝送路の使用率に対する遅延時間の増加の程度は`CDMA/CD方式`よりも緩やか.  

- ネットワーク上をフリートークンと呼ばれる送信権のためのパケットが巡回する
- フリートークンを獲得したノードのみが送信を行うので衝突を回避できる


#### TDMA方式




## ネットワーク層の制御とプロトコル

## トランスポート層のプロトコル

## アプリケーション層のプロトコル

## 伝送技術

## 交換方式

## 無線LAN

