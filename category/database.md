# 2. データベース
## データベースの設計
### 概念設計
概念データモデルを作成する. `E-Rモデル`や`UMLクラス図`を使用して記述する.  

#### データ項目の洗い出し
1. データ項目名の標準化
2. データ項目の意味の定義
3. データ項目の桁数や型の統一
4. 各データ項目の発生源や発生量の明確化

### 論理設計
概念データモデルを、論理データモデルと言われるデータベース構造モデルに変換する.  
主キーや外部キーを含めたテーブル構造を作成する.  
ビューの定義を行うのもこの段階.  

### 物理設計
データ量、データの利用頻度、パフォーマンス性を考慮してデータベースの物理的構造を決める.  

## 3層スキーマ
### 外部スキーマ
利用者やアプリケーションプログラムから見たデータの定義を行う. 
### 概念スキーマ
データベースの論理的構造とその内容を定義する. 論理データモデルが該当.
### 内部スキーマ
物理的内容の定義を行う. 

### E-R図
#### 多対多の関係
多対多の関係は、1対多、多対1の関係に分解する.  

## 関係データベース
### キー
#### スーパーキー
表中の行を一位に特定できる属性、あるいは属性の組みを`スーパーキー`とよぶ.  
#### 候補キー
必要最小限の属性によって構成されるスーパーキー.  
一意性制約が設定される.  
#### 主キー
複数の候補キーの中から任意に選んだ1つのキー.  
主キーに選ばれなかった残りの候補キーを`代理キー`と呼ぶ.  
#### 外部キー
関連する他の表を参照する属性あるいは属性の組み.  
2つの表の間に「1対多」の関係がある場合、「多」側の表に「1」側の表の主キーあるいは主キー以外の候補キーを参照する属性を持たせて、これを外部キーとする. これにより、外部キーの値が被参照表に存在することを保証する`参照制約`が確保できる.  

## 正規化
### 正規化の目的
正規化の目的は、データ操作に伴う更新時以上の発生を防ぐこと.  
正規化により属性間の関数従属を少なくし、かつ、データの重複を排除することで更新時異常の発生を防ぐ.  
ただし、正規化を進めると表の結合が必要になり処理時間がかかる.  

### 関数従属
ある属性xの値が決まると他の属性yの値が一意的に決まる関係.  

### 第１正規化
繰り返し部分を排除して平坦にする操作.  

#### データ操作での不具合
##### 修正時異常
レコードを変更する場合、該当する行を全て同時に変更しないとデータに不整合が発生する.  

##### 挿入時異常
主キーがNULLのレコードは登録できない.  

##### 削除時異常
関係従属するデータが１つだけの場合、関係従属するデータを削除すると、元となるデータも削除されてしまう.  



### 第２正規化
全ての非キー属性が、各候補機ーに完全関数従属である状態にする操作.  
つまり、部分関数従属している項目は全て他の表として独立させる.  


### 第３正規化
候補キーに推移的関数従属している非キー属性を別の表に分解する.  
元の表には外部キーを残す.


## データベースの演算

SQLの操作方法は、  
[ゼロから始めるデータベース操作](../sql.md)
を参照.  

